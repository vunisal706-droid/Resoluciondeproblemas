<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Generador de Problemas MatemÃ¡ticos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    canvas { 
      touch-action: none;
      cursor: crosshair;
    }
    .problem-card {
      background: linear-gradient(to bottom right, #ffffff, #f8fafc);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .problem-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s;
    }
    .btn-primary:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }
    .canvas-container {
      background: #fefefe;
      border: 2px dashed #cbd5e1;
      border-radius: 12px;
      position: relative;
    }
    .step-number {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 8px;
    }
  </style>
</head>
<body class="p-4 md:p-8">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-3xl shadow-2xl p-6 md:p-10 mb-8">
      <h1 class="text-4xl md:text-5xl font-bold text-center mb-2 bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">
        âœ¨ Generador de Problemas MatemÃ¡ticos âœ¨
      </h1>
      <p class="text-center text-gray-600 text-lg">Aprende matemÃ¡ticas de forma divertida</p>
    </div>

    <!-- Controles -->
    <div class="bg-white rounded-3xl shadow-2xl p-8 md:p-12 mb-8">
      <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Configura tu ejercicio</h2>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
        <!-- Curso -->
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-6 border-2 border-blue-200 hover:shadow-lg transition">
          <label class="flex items-center justify-center gap-3 font-bold text-gray-800 mb-4 text-2xl">
            <span class="text-4xl">ğŸ“š</span>
            <span>Curso</span>
          </label>
          <select id="curso" class="w-full p-5 border-3 border-blue-300 rounded-xl focus:border-blue-500 focus:outline-none text-xl font-semibold bg-white shadow-md cursor-pointer hover:bg-blue-50 transition">
            <option value="1">1Âº Primaria</option>
            <option value="2">2Âº Primaria</option>
            <option value="3">3Âº Primaria</option>
            <option value="4">4Âº Primaria</option>
            <option value="5">5Âº Primaria</option>
            <option value="6">6Âº Primaria</option>
          </select>
        </div>

        <!-- Mes -->
        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl p-6 border-2 border-green-200 hover:shadow-lg transition">
          <label class="flex items-center justify-center gap-3 font-bold text-gray-800 mb-4 text-2xl">
            <span class="text-4xl">ğŸ“…</span>
            <span>Mes</span>
          </label>
          <select id="mes" class="w-full p-5 border-3 border-green-300 rounded-xl focus:border-green-500 focus:outline-none text-xl font-semibold bg-white shadow-md cursor-pointer hover:bg-green-50 transition">
            <option value="octubre">Octubre</option>
            <option value="noviembre">Noviembre</option>
            <option value="diciembre">Diciembre</option>
            <option value="enero">Enero</option>
            <option value="febrero">Febrero</option>
            <option value="marzo">Marzo</option>
            <option value="abril">Abril</option>
            <option value="mayo">Mayo</option>
            <option value="junio">Junio</option>
          </select>
        </div>

        <!-- NÃºmero de Problemas -->
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl p-6 border-2 border-purple-200 hover:shadow-lg transition">
          <label class="flex items-center justify-center gap-3 font-bold text-gray-800 mb-4 text-2xl">
            <span class="text-4xl">ğŸ”¢</span>
            <span>Problemas</span>
          </label>
          <select id="numProblemas" class="w-full p-5 border-3 border-purple-300 rounded-xl focus:border-purple-500 focus:outline-none text-xl font-semibold bg-white shadow-md cursor-pointer hover:bg-purple-50 transition">
            <option value="1">1 problema</option>
            <option value="2">2 problemas</option>
            <option value="3">3 problemas</option>
          </select>
        </div>
      </div>

      <!-- BotÃ³n Generar -->
      <div class="text-center space-y-4">
        <button id="btnGenerar" class="btn-primary text-white px-16 py-6 rounded-2xl font-bold text-2xl shadow-2xl transform hover:scale-105 transition-all">
          <span class="text-3xl mr-3">ğŸ¯</span>
          Generar Problemas
        </button>
        
        <div>
          <button id="btnResetear" class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-xl font-semibold text-lg shadow-lg transform hover:scale-105 transition-all">
            <span class="text-xl mr-2">ğŸ”„</span>
            Resetear Problemas Usados
          </button>
          <p class="text-sm text-gray-600 mt-2">Usa este botÃ³n si ya no te genera problemas nuevos</p>
        </div>
      </div>
    </div>

    <!-- Resultados -->
    <div id="resultado"></div>
  </div>

  <script>
    // Base de datos completa de problemas
    const DB = {
      1: {
        octubre: [
          {id:"1-oct-1", t:"MarÃ­a tiene n1 caramelos en su bolsillo. Su amigo Luis le regala n2 caramelos mÃ¡s. Â¿CuÃ¡ntos caramelos tiene MarÃ­a ahora en total?"},
          {id:"1-oct-2", t:"En una cesta hay n1 manzanas rojas. Ana pone n2 manzanas verdes mÃ¡s en la cesta. Â¿CuÃ¡ntas manzanas hay ahora en la cesta?"},
          {id:"1-oct-3", t:"Pablo guarda n1 lÃ¡pices en su estuche azul y n2 lÃ¡pices en su estuche verde. Â¿CuÃ¡ntos lÃ¡pices tiene Pablo entre los dos estuches?"}
        ],
        noviembre: [
          {id:"1-nov-1", t:"En la jugueterÃ­a hay n1 pelotas en un estante. El dueÃ±o coloca n2 pelotas mÃ¡s. Â¿CuÃ¡ntas pelotas hay ahora en el estante?"},
          {id:"1-nov-2", t:"Sara tiene n1 muÃ±ecos en su habitaciÃ³n y sus padres le regalan n2 muÃ±ecos mÃ¡s por su cumpleaÃ±os. Â¿CuÃ¡ntos muÃ±ecos tiene Sara ahora?"},
          {id:"1-nov-3", t:"En el parque hay n1 columpios funcionando. Arreglan n2 columpios que estaban rotos. Â¿CuÃ¡ntos columpios hay disponibles ahora para jugar?"}
        ],
        diciembre: [
          {id:"1-dic-1", t:"En el Ã¡rbol de Navidad hay n1 bolas rojas y n2 bolas doradas. Â¿CuÃ¡ntas bolas hay en total decorando el Ã¡rbol?"},
          {id:"1-dic-2", t:"Carlos recibe n1 regalos de sus abuelos y n2 regalos de sus tÃ­os en Navidad. Â¿CuÃ¡ntos regalos recibiÃ³ Carlos en total?"},
          {id:"1-dic-3", t:"En la mesa hay n1 turrones y n2 polvorones. Â¿CuÃ¡ntos dulces hay en total en la mesa?"}
        ],
        enero: [
          {id:"1-ene-1", t:"Los Reyes Magos traen n1 juguetes a una casa. Al dÃ­a siguiente, los niÃ±os reciben n2 juguetes mÃ¡s de sus tÃ­os. Â¿CuÃ¡ntos juguetes tienen ahora?"},
          {id:"1-ene-2", t:"En la clase hay n1 niÃ±os con gorro y n2 niÃ±os sin gorro. Â¿CuÃ¡ntos niÃ±os hay en total en la clase?"},
          {id:"1-ene-3", t:"Laura colecciona cromos. Tiene n1 cromos de animales y n2 cromos de deportes. Â¿CuÃ¡ntos cromos tiene Laura en su colecciÃ³n?"}
        ],
        febrero: [
          {id:"1-feb-1", t:"Pedro tiene n1 globos rojos para la fiesta. Su hermana le da n2 globos azules. Â¿CuÃ¡ntos globos tiene Pedro para decorar?"},
          {id:"1-feb-2", t:"En la pecera hay n1 peces dorados y n2 peces de colores. Â¿CuÃ¡ntos peces nadan en la pecera?"},
          {id:"1-feb-3", t:"Ana dibuja n1 flores en su cuaderno. DespuÃ©s dibuja n2 flores mÃ¡s. Â¿CuÃ¡ntas flores ha dibujado Ana en total?"}
        ],
        marzo: [
          {id:"1-mar-1", t:"En el jardÃ­n hay n1 mariposas amarillas volando. Llegan n2 mariposas mÃ¡s. Â¿CuÃ¡ntas mariposas hay ahora en el jardÃ­n?"},
          {id:"1-mar-2", t:"Luis planta n1 semillas de tomate y n2 semillas de lechuga en su huerto. Â¿CuÃ¡ntas semillas ha plantado Luis en total?"},
          {id:"1-mar-3", t:"En la granja hay n1 pollitos en el corral y n2 pollitos en el nido. Â¿CuÃ¡ntos pollitos hay en total?"}
        ],
        abril: [
          {id:"1-abr-1", t:"MarÃ­a recoge n1 huevos de Pascua en el jardÃ­n. Su hermano encuentra n2 huevos mÃ¡s. Â¿CuÃ¡ntos huevos de Pascua han encontrado entre los dos?"},
          {id:"1-abr-2", t:"En la librerÃ­a compran n1 cuentos de princesas y n2 cuentos de piratas. Â¿CuÃ¡ntos cuentos han comprado en total?"},
          {id:"1-abr-3", t:"Pablo tiene n1 coches de juguete rojos y recibe n2 coches amarillos. Â¿CuÃ¡ntos coches tiene ahora Pablo?"}
        ],
        mayo: [
          {id:"1-may-1", t:"En el florero hay n1 rosas y n2 margaritas. Â¿CuÃ¡ntas flores hay en el florero?"},
          {id:"1-may-2", t:"Sara tiene n1 cuentas azules y n2 cuentas verdes para hacer un collar. Â¿CuÃ¡ntas cuentas tiene en total?"},
          {id:"1-may-3", t:"En la playa, Carlos recoge n1 conchas grandes y n2 conchas pequeÃ±as. Â¿CuÃ¡ntas conchas ha recogido Carlos?"}
        ],
        junio: [
          {id:"1-jun-1", t:"En la piscina hay n1 niÃ±os nadando y n2 niÃ±os jugando en el borde. Â¿CuÃ¡ntos niÃ±os hay en total en la piscina?"},
          {id:"1-jun-2", t:"Laura tiene n1 helados de fresa y compra n2 helados de chocolate. Â¿CuÃ¡ntos helados tiene Laura?"},
          {id:"1-jun-3", t:"En el parque acuÃ¡tico hay n1 toboganes azules y n2 toboganes rojos. Â¿CuÃ¡ntos toboganes hay en total?"}
        ]
      },

      2: {
        octubre: [
          {id:"2-oct-1", t:"Carlos compra una bolsa con n1 caramelos. Regala n2 caramelos a sus amigos en el recreo. Â¿CuÃ¡ntos caramelos le quedan a Carlos?"},
          {id:"2-oct-2", t:"En una caja hay n1 lÃ¡pices de colores. Ana saca n2 lÃ¡pices para dibujar. Â¿CuÃ¡ntos lÃ¡pices quedan en la caja?"},
          {id:"2-oct-3", t:"MarÃ­a tiene n1 cromos en su Ã¡lbum y pega n2 cromos nuevos que le han regalado. Â¿CuÃ¡ntos cromos tiene ahora MarÃ­a en su Ã¡lbum?"}
        ],
        noviembre: [
          {id:"2-nov-1", t:"En la biblioteca hay n1 libros de cuentos en un estante. Los niÃ±os devuelven n2 libros mÃ¡s. Â¿CuÃ¡ntos libros hay ahora en el estante?"},
          {id:"2-nov-2", t:"Pedro tiene n1 euros ahorrados. Su abuela le da n2 euros mÃ¡s. Â¿CuÃ¡ntos euros tiene Pedro ahora?"},
          {id:"2-nov-3", t:"En una granja hay n1 gallinas y n2 pollos. Â¿CuÃ¡ntas aves hay en total en la granja?"}
        ],
        diciembre: [
          {id:"2-dic-1", t:"Sara va a comprar chuches con n1 cÃ©ntimos. Gasta n2 cÃ©ntimos en un chicle. Â¿CuÃ¡ntos cÃ©ntimos le quedan?"},
          {id:"2-dic-2", t:"En el belÃ©n hay n1 figuras de pastores y n2 figuras de ovejas. Â¿CuÃ¡ntas figuras hay en total en el belÃ©n?"},
          {id:"2-dic-3", t:"Luis tiene n1 bolas de adorno y compra n2 bolas mÃ¡s para decorar el Ã¡rbol. Â¿CuÃ¡ntas bolas tiene ahora Luis?"}
        ],
        enero: [
          {id:"2-ene-1", t:"En la jugueterÃ­a hay n1 muÃ±ecas en un estante. Venden n2 muÃ±ecas durante la maÃ±ana. Â¿CuÃ¡ntas muÃ±ecas quedan en el estante?"},
          {id:"2-ene-2", t:"Ana tiene n1 pegatinas brillantes y regala n2 pegatinas a su mejor amiga. Â¿CuÃ¡ntas pegatinas le quedan a Ana?"},
          {id:"2-ene-3", t:"Carlos colecciona n1 coches de juguete. Por los Reyes recibe n2 coches mÃ¡s. Â¿CuÃ¡ntos coches tiene Carlos en su colecciÃ³n ahora?"}
        ],
        febrero: [
          {id:"2-feb-1", t:"En una cuerda para tender hay n1 calcetines. MarÃ­a cuelga n2 calcetines mÃ¡s. Â¿CuÃ¡ntos calcetines hay ahora en la cuerda?"},
          {id:"2-feb-2", t:"Pedro tiene n1 globos para la fiesta de carnaval. Se le escapan n2 globos volando. Â¿CuÃ¡ntos globos le quedan a Pedro?"},
          {id:"2-feb-3", t:"En la clase hay n1 disfraces de superhÃ©roes y n2 disfraces de princesas. Â¿CuÃ¡ntos disfraces hay en total?"}
        ],
        marzo: [
          {id:"2-mar-1", t:"Sara planta n1 flores rojas en su jardÃ­n. A la semana siguiente planta n2 flores amarillas. Â¿CuÃ¡ntas flores ha plantado Sara en total?"},
          {id:"2-mar-2", t:"En el parque hay n1 columpios ocupados y n2 columpios libres. Â¿CuÃ¡ntos columpios hay en total en el parque?"},
          {id:"2-mar-3", t:"Luis tiene n1 canicas de cristal y gana n2 canicas mÃ¡s jugando con sus amigos. Â¿CuÃ¡ntas canicas tiene Luis ahora?"}
        ],
        abril: [
          {id:"2-abr-1", t:"MarÃ­a recoge n1 huevos de chocolate en la bÃºsqueda de Pascua. Su hermano recoge n2 huevos. Â¿CuÃ¡ntos huevos han recogido entre los dos?"},
          {id:"2-abr-2", t:"En una cesta hay n1 zanahorias y el conejo se come n2 zanahorias. Â¿CuÃ¡ntas zanahorias quedan en la cesta?"},
          {id:"2-abr-3", t:"Carlos tiene n1 pollitos de juguete y le regalan n2 pollitos mÃ¡s. Â¿CuÃ¡ntos pollitos tiene Carlos ahora?"}
        ],
        mayo: [
          {id:"2-may-1", t:"Ana compra n1 flores para su madre y su padre compra n2 flores mÃ¡s. Â¿CuÃ¡ntas flores tienen para regalar?"},
          {id:"2-may-2", t:"En el jardÃ­n hay n1 mariposas por la maÃ±ana. Por la tarde llegan n2 mariposas mÃ¡s. Â¿CuÃ¡ntas mariposas hay en el jardÃ­n por la tarde?"},
          {id:"2-may-3", t:"Pedro tiene n1 caracoles en su terrario y encuentra n2 caracoles mÃ¡s en el jardÃ­n. Â¿CuÃ¡ntos caracoles tiene Pedro ahora?"}
        ],
        junio: [
          {id:"2-jun-1", t:"Sara tiene n1 conchas marinas y regala n2 conchas a su amiga. Â¿CuÃ¡ntas conchas le quedan a Sara?"},
          {id:"2-jun-2", t:"En la playa hay n1 castillos de arena. Los niÃ±os construyen n2 castillos mÃ¡s. Â¿CuÃ¡ntos castillos de arena hay ahora?"},
          {id:"2-jun-3", t:"Luis compra n1 helados para sus amigos y n2 helados para su familia. Â¿CuÃ¡ntos helados ha comprado Luis en total?"}
        ]
      },

      3: {
        octubre: [
          {id:"3-oct-1", t:"En una tienda hay n1 paquetes de galletas. Cada paquete contiene n2 galletas. Â¿CuÃ¡ntas galletas hay en total en la tienda?"},
          {id:"3-oct-2", t:"MarÃ­a tiene n1 cajas de colores. En cada caja hay n2 lÃ¡pices de colores. Â¿CuÃ¡ntos lÃ¡pices tiene MarÃ­a en total?"},
          {id:"3-oct-3", t:"Carlos compra n1 bolsas de caramelos. Cada bolsa contiene n2 caramelos. Â¿CuÃ¡ntos caramelos ha comprado Carlos?"}
        ],
        noviembre: [
          {id:"3-nov-1", t:"En una granja hay n1 corrales. En cada corral hay n2 conejos. Â¿CuÃ¡ntos conejos hay en total en la granja?"},
          {id:"3-nov-2", t:"Sara reparte n1 cromos entre n2 amigos, dÃ¡ndole la misma cantidad a cada uno. Â¿CuÃ¡ntos cromos recibe cada amigo?"},
          {id:"3-nov-3", t:"Pedro tiene n1 paquetes de pegatinas. Cada paquete tiene n2 pegatinas. Â¿CuÃ¡ntas pegatinas tiene Pedro en total?"}
        ],
        diciembre: [
          {id:"3-dic-1", t:"Luis compra n1 cajas de turrones para Navidad. Cada caja cuesta n2 euros. Â¿CuÃ¡nto dinero gasta Luis en total?"},
          {id:"3-dic-2", t:"En una tienda de juguetes hay n1 estantes. En cada estante hay n2 muÃ±ecos. Â¿CuÃ¡ntos muÃ±ecos hay en total?"},
          {id:"3-dic-3", t:"Ana reparte n1 bombones entre n2 personas de su familia. Â¿CuÃ¡ntos bombones recibe cada persona si los reparte en partes iguales?"}
        ],
        enero: [
          {id:"3-ene-1", t:"MarÃ­a tiene n1 Ã¡lbumes de cromos. Cada Ã¡lbum tiene n2 pÃ¡ginas. Â¿CuÃ¡ntas pÃ¡ginas hay en total entre todos los Ã¡lbumes?"},
          {id:"3-ene-2", t:"Carlos compra n1 paquetes de chicles. Cada paquete contiene n2 chicles. Â¿CuÃ¡ntos chicles tiene Carlos?"},
          {id:"3-ene-3", t:"En una escuela hay n1 clases de tercero. En cada clase hay n2 estudiantes. Â¿CuÃ¡ntos estudiantes de tercero hay en total?"}
        ],
        febrero: [
          {id:"3-feb-1", t:"Sara tiene n1 cajas de pinturas. Cada caja contiene n2 pinturas. Â¿CuÃ¡ntas pinturas tiene Sara en total?"},
          {id:"3-feb-2", t:"Pedro reparte n1 globos entre n2 niÃ±os en una fiesta. Â¿CuÃ¡ntos globos recibe cada niÃ±o si los reparte equitativamente?"},
          {id:"3-feb-3", t:"Luis tiene n1 bolsas con n2 canicas cada una. Â¿CuÃ¡ntas canicas tiene Luis en total?"}
        ],
        marzo: [
          {id:"3-mar-1", t:"En un jardÃ­n hay n1 macetas. En cada maceta hay n2 flores plantadas. Â¿CuÃ¡ntas flores hay en total en el jardÃ­n?"},
          {id:"3-mar-2", t:"Ana compra n1 paquetes de semillas. Cada paquete contiene n2 semillas. Â¿CuÃ¡ntas semillas ha comprado Ana?"},
          {id:"3-mar-3", t:"Carlos divide n1 lÃ¡pices entre n2 estuches, poniendo la misma cantidad en cada uno. Â¿CuÃ¡ntos lÃ¡pices hay en cada estuche?"}
        ],
        abril: [
          {id:"3-abr-1", t:"MarÃ­a compra n1 hueveras. Cada huevera tiene capacidad para n2 huevos. Â¿CuÃ¡ntos huevos puede guardar en total?"},
          {id:"3-abr-2", t:"En una librerÃ­a hay n1 estanterÃ­as. En cada estanterÃ­a hay n2 libros. Â¿CuÃ¡ntos libros hay en la librerÃ­a?"},
          {id:"3-abr-3", t:"Pedro reparte n1 gominolas entre n2 amigos. Â¿CuÃ¡ntas gominolas recibe cada amigo?"}
        ],
        mayo: [
          {id:"3-may-1", t:"Sara tiene n1 ramos de flores. Cada ramo tiene n2 flores. Â¿CuÃ¡ntas flores tiene Sara en total?"},
          {id:"3-may-2", t:"Luis organiza n1 mesas para una fiesta. En cada mesa sienta n2 personas. Â¿CuÃ¡ntas personas pueden sentarse en total?"},
          {id:"3-may-3", t:"Ana compra n1 bolsas de fresas. Cada bolsa contiene n2 fresas. Â¿CuÃ¡ntas fresas ha comprado Ana?"}
        ],
        junio: [
          {id:"3-jun-1", t:"Carlos tiene n1 cubos de arena. En cada cubo caben n2 litros de agua. Â¿CuÃ¡ntos litros de agua puede llenar en total?"},
          {id:"3-jun-2", t:"MarÃ­a reparte n1 helados entre n2 niÃ±os en la playa. Â¿CuÃ¡ntos helados recibe cada niÃ±o?"},
          {id:"3-jun-3", t:"Pedro compra n1 paquetes de piruletas. Cada paquete contiene n2 piruletas. Â¿CuÃ¡ntas piruletas tiene Pedro?"}
        ]
      },

      4: {
        octubre: [
          {id:"4-oct-1", t:"En una biblioteca hay n1 estanterÃ­as. Cada estanterÃ­a tiene n2 libros. Si retiran 15 libros para una exposiciÃ³n, Â¿cuÃ¡ntos libros quedan en las estanterÃ­as?"},
          {id:"4-oct-2", t:"MarÃ­a ahorra n1 euros cada mes. Â¿CuÃ¡nto dinero habrÃ¡ ahorrado despuÃ©s de n2 meses?"},
          {id:"4-oct-3", t:"Carlos compra n1 cajas de rotuladores. Cada caja contiene n2 rotuladores y cuesta 8 euros. Â¿CuÃ¡nto dinero gasta en total y cuÃ¡ntos rotuladores tiene?"}
        ],
        noviembre: [
          {id:"4-nov-1", t:"Una panaderÃ­a produce n1 barras de pan cada hora. Â¿CuÃ¡ntas barras producirÃ¡ en n2 horas de trabajo?"},
          {id:"4-nov-2", t:"Sara tiene n1 pegatinas y las reparte equitativamente entre n2 amigos. Â¿CuÃ¡ntas pegatinas recibe cada amigo?"},
          {id:"4-nov-3", t:"Pedro compra n1 paquetes de galletas que cuestan n2 euros cada uno. Paga con un billete de 50 euros. Â¿CuÃ¡nto dinero le devuelven?"}
        ],
        diciembre: [
          {id:"4-dic-1", t:"Luis compra n1 cajas de bombones para regalar. Cada caja contiene n2 bombones. Si regala 3 cajas completas, Â¿cuÃ¡ntos bombones le quedan?"},
          {id:"4-dic-2", t:"Ana recorre n1 kilÃ³metros cada dÃ­a durante n2 dÃ­as. Â¿CuÃ¡ntos kilÃ³metros ha recorrido en total?"},
          {id:"4-dic-3", t:"En una tienda hay n1 estantes con n2 juguetes cada uno. Si venden la mitad de los juguetes, Â¿cuÃ¡ntos juguetes quedan en la tienda?"}
        ],
        enero: [
          {id:"4-ene-1", t:"MarÃ­a colecciona n1 cromos cada semana. Â¿CuÃ¡ntos cromos habrÃ¡ coleccionado despuÃ©s de n2 semanas?"},
          {id:"4-ene-2", t:"Carlos tiene n1 cajas con n2 lÃ¡pices en cada caja. Regala una caja completa. Â¿CuÃ¡ntos lÃ¡pices le quedan?"},
          {id:"4-ene-3", t:"Sara reparte n1 caramelos equitativamente entre n2 niÃ±os. Â¿CuÃ¡ntos caramelos recibe cada niÃ±o y cuÃ¡ntos sobran?"}
        ],
        febrero: [
          {id:"4-feb-1", t:"Pedro tiene n1 paquetes de pegatinas con n2 pegatinas cada uno. Usa 10 pegatinas para decorar su cuaderno. Â¿CuÃ¡ntas pegatinas le quedan?"},
          {id:"4-feb-2", t:"Luis lee n1 pÃ¡ginas de un libro cada dÃ­a durante n2 dÃ­as. Si el libro tiene 200 pÃ¡ginas, Â¿cuÃ¡ntas pÃ¡ginas le faltan por leer?"},
          {id:"4-feb-3", t:"Ana compra n1 bolsas de chuches a n2 euros cada una. Si paga con 20 euros, Â¿cuÃ¡nto dinero le devuelven?"}
        ],
        marzo: [
          {id:"4-mar-1", t:"MarÃ­a planta n1 filas de flores con n2 flores en cada fila. Si se marchitan 8 flores, Â¿cuÃ¡ntas flores quedan en buen estado?"},
          {id:"4-mar-2", t:"Carlos tiene n1 cajas con n2 ceras de colores cada una. Pierde una caja completa. Â¿CuÃ¡ntas ceras le quedan?"},
          {id:"4-mar-3", t:"Sara reparte n1 cromos entre n2 amigas de manera equitativa. Â¿CuÃ¡ntos cromos recibe cada amiga?"}
        ],
        abril: [
          {id:"4-abr-1", t:"Pedro compra n1 paquetes de chicles. Cada paquete contiene n2 chicles y cuesta 3 euros. Â¿CuÃ¡nto gasta en total y cuÃ¡ntos chicles tiene?"},
          {id:"4-abr-2", t:"Luis tiene n1 Ã¡lbumes de fotos con n2 fotos en cada Ã¡lbum. AÃ±ade 12 fotos nuevas a uno de los Ã¡lbumes. Â¿CuÃ¡ntas fotos tiene ahora en total?"},
          {id:"4-abr-3", t:"Ana organiza n1 mesas para una fiesta. En cada mesa sientan n2 personas. Si llegan 5 personas mÃ¡s, Â¿cuÃ¡ntas personas hay en total?"}
        ],
        mayo: [
          {id:"4-may-1", t:"MarÃ­a ahorra n1 euros en enero, n2 euros en febrero y el doble de febrero en marzo. Â¿CuÃ¡nto dinero ha ahorrado en total en los tres meses?"},
          {id:"4-may-2", t:"Carlos compra n1 bolsas de caramelos con n2 caramelos cada una. Come 7 caramelos. Â¿CuÃ¡ntos caramelos le quedan?"},
          {id:"4-may-3", t:"Sara reparte n1 globos entre n2 niÃ±os. Si sobran algunos globos, Â¿cuÃ¡ntos recibe cada niÃ±o y cuÃ¡ntos sobran?"}
        ],
        junio: [
          {id:"4-jun-1", t:"Pedro va a la playa n1 dÃ­as durante las vacaciones. Cada dÃ­a recoge n2 conchas. Â¿CuÃ¡ntas conchas ha recogido en total?"},
          {id:"4-jun-2", t:"Luis compra n1 helados a n2 euros cada uno. Si paga con un billete de 50 euros, Â¿cuÃ¡nto dinero le devuelven?"},
          {id:"4-jun-3", t:"Ana tiene n1 cajas de juguetes con n2 juguetes en cada caja. Regala 15 juguetes en total. Â¿CuÃ¡ntos juguetes le quedan?"}
        ]
      },

      5: {
        octubre: [
          {id:"5-oct-1", t:"Una tienda vende n1 cajas de zumos. Cada caja contiene n2 botellas y cada botella cuesta 2,50 euros. Â¿CuÃ¡l es el valor total de todos los zumos?"},
          {id:"5-oct-2", t:"MarÃ­a tiene n1 paquetes de cromos. Cada paquete contiene n2 cromos. Si regala la tercera parte de los cromos, Â¿cuÃ¡ntos cromos le quedan?"},
          {id:"5-oct-3", t:"Carlos va al cine con n1 amigos. Cada entrada cuesta n2 euros y tambiÃ©n compran palomitas por 5 euros cada uno. Â¿CuÃ¡nto gastan en total entre todos?"}
        ],
        noviembre: [
          {id:"5-nov-1", t:"En una biblioteca hay n1 estanterÃ­as con n2 libros cada una. Si prestan 45 libros, Â¿cuÃ¡ntos libros quedan en la biblioteca?"},
          {id:"5-nov-2", t:"Sara compra n1 bolsas de manzanas. Cada bolsa contiene n2 manzanas y pesa 3 kg. Â¿CuÃ¡l es el peso total de todas las manzanas?"},
          {id:"5-nov-3", t:"Pedro ahorra n1 euros cada semana durante n2 semanas. Si gasta la cuarta parte en un videojuego, Â¿cuÃ¡nto dinero le queda?"}
        ],
        diciembre: [
          {id:"5-dic-1", t:"Luis compra n1 cajas de bombones para regalar en Navidad. Cada caja contiene n2 bombones y cuesta 12 euros. Â¿CuÃ¡nto gasta en total y cuÃ¡ntos bombones tiene?"},
          {id:"5-dic-2", t:"Ana tiene n1 paquetes de adornos navideÃ±os con n2 adornos en cada paquete. Usa 18 adornos para decorar el Ã¡rbol. Â¿CuÃ¡ntos adornos le quedan?"},
          {id:"5-dic-3", t:"MarÃ­a reparte n1 regalos entre n2 familiares de forma equitativa. Si comprÃ³ cada regalo por 8 euros, Â¿cuÃ¡nto gastÃ³ en total?"}
        ],
        enero: [
          {id:"5-ene-1", t:"Carlos recibe n1 euros de cada uno de sus n2 tÃ­os por Reyes. Si ya tenÃ­a ahorrados 50 euros, Â¿cuÃ¡nto dinero tiene ahora?"},
          {id:"5-ene-2", t:"Sara tiene n1 cajas de juguetes con n2 juguetes en cada caja. Dona la quinta parte de los juguetes a una ONG. Â¿CuÃ¡ntos juguetes le quedan?"},
          {id:"5-ene-3", t:"Pedro compra n1 libros que cuestan n2 euros cada uno. Si tiene un descuento del 10%, Â¿cuÃ¡nto paga en total?"}
        ],
        febrero: [
          {id:"5-feb-1", t:"Luis recorre n1 kilÃ³metros cada dÃ­a durante n2 dÃ­as entrenando para una carrera. Si la carrera es de 100 km, Â¿cuÃ¡ntos kilÃ³metros le faltan por entrenar?"},
          {id:"5-feb-2", t:"Ana compra n1 bolsas de chuches con n2 chuches cada una para una fiesta. Si invita a 15 niÃ±os y reparte todas las chuches equitativamente, Â¿cuÃ¡ntas chuches recibe cada niÃ±o?"},
          {id:"5-feb-3", t:"MarÃ­a tiene n1 paquetes de globos con n2 globos cada uno. Infla la mitad de los globos. Â¿CuÃ¡ntos globos ha inflado?"}
        ],
        marzo: [
          {id:"5-mar-1", t:"Carlos planta n1 filas de tomates con n2 plantas en cada fila. Si cada planta produce 8 tomates, Â¿cuÃ¡ntos tomates recogerÃ¡ en total?"},
          {id:"5-mar-2", t:"Sara compra n1 cajas de rotuladores con n2 rotuladores cada una. Cada caja cuesta 6,50 euros. Â¿CuÃ¡nto gasta en total?"},
          {id:"5-mar-3", t:"Pedro tiene n1 Ã¡lbumes de cromos con n2 cromos en cada Ã¡lbum. Si le faltan 25 cromos para completar todos los Ã¡lbumes que tienen 200 cromos cada uno, Â¿cuÃ¡ntos cromos tiene?"}
        ],
        abril: [
          {id:"5-abr-1", t:"Luis compra n1 paquetes de semillas con n2 semillas cada uno para su huerto. Planta tres cuartas partes de las semillas. Â¿CuÃ¡ntas semillas ha plantado?"},
          {id:"5-abr-2", t:"Ana organiza n1 equipos para un torneo. Cada equipo tiene n2 jugadores. Si cada jugador paga 3 euros de inscripciÃ³n, Â¿cuÃ¡nto dinero se recauda?"},
          {id:"5-abr-3", t:"MarÃ­a compra n1 cajas de huevos de Pascua con n2 huevos en cada caja. Cada huevo cuesta 2,75 euros. Â¿CuÃ¡l es el coste total?"}
        ],
        mayo: [
          {id:"5-may-1", t:"Carlos tiene n1 macetas con n2 flores en cada una. Si regala 3 macetas completas a su madre, Â¿cuÃ¡ntas flores le quedan?"},
          {id:"5-may-2", t:"Sara lee n1 pÃ¡ginas cada dÃ­a de un libro de n2 pÃ¡ginas. Â¿CuÃ¡ntos dÃ­as tardarÃ¡ en terminar el libro?"},
          {id:"5-may-3", t:"Pedro compra n1 bolsas de fresas con n2 fresas cada una. Si hace tartas usando 8 fresas por tarta, Â¿cuÃ¡ntas tartas puede hacer?"}
        ],
        junio: [
          {id:"5-jun-1", t:"Luis va n1 dÃ­as a la playa durante las vacaciones. Cada dÃ­a recoge n2 conchas. Si regala la mitad de las conchas, Â¿cuÃ¡ntas conchas le quedan?"},
          {id:"5-jun-2", t:"Ana compra n1 helados a n2 euros cada uno para su familia. Si paga con un billete de 50 euros, Â¿cuÃ¡nto dinero le devuelven?"},
          {id:"5-jun-3", t:"MarÃ­a organiza n1 mesas en una fiesta con n2 sillas en cada mesa. Si llegan 85 invitados, Â¿sobran o faltan sillas y cuÃ¡ntas?"}
        ]
      },

      6: {
        octubre: [
          {id:"6-oct-1", t:"Una empresa produce n1 cajas de galletas al dÃ­a. Cada caja contiene n2 paquetes y cada paquete tiene 12 galletas. Â¿CuÃ¡ntas galletas producen en una semana (7 dÃ­as)?"},
          {id:"6-oct-2", t:"Carlos compra n1 libros que cuestan n2 euros cada uno. Si tiene un cupÃ³n de descuento del 15%, Â¿cuÃ¡nto pagarÃ¡ en total?"},
          {id:"6-oct-3", t:"MarÃ­a tiene n1 cajas de rotuladores con n2 rotuladores en cada caja. Si regala 2 cajas completas y despuÃ©s usa 15 rotuladores, Â¿cuÃ¡ntos rotuladores le quedan?"}
        ],
        noviembre: [
          {id:"6-nov-1", t:"Sara ahorra n1 euros cada mes durante n2 meses. Si gasta dos quintas partes en un regalo, Â¿cuÃ¡nto dinero le queda?"},
          {id:"6-nov-2", t:"Pedro organiza n1 equipos deportivos con n2 jugadores cada uno. Cada jugador paga 25 euros de inscripciÃ³n. Â¿CuÃ¡nto dinero se recauda en total?"},
          {id:"6-nov-3", t:"Luis compra n1 paquetes de cromos con n2 cromos en cada paquete. Si intercambia la tercera parte de los cromos, Â¿cuÃ¡ntos cromos intercambia?"}
        ],
        diciembre: [
          {id:"6-dic-1", t:"Ana compra n1 cajas de turrones que cuestan n2 euros cada una. TambiÃ©n compra 3 botellas de sidra a 4,50 euros cada una. Â¿CuÃ¡nto gasta en total?"},
          {id:"6-dic-2", t:"Carlos reparte n1 regalos entre n2 familiares. Si cada regalo costÃ³ 18 euros y tiene un descuento del 20% en el total, Â¿cuÃ¡nto pagÃ³?"},
          {id:"6-dic-3", t:"MarÃ­a tiene n1 cajas de bombones con n2 bombones en cada caja. Si come 5 bombones de cada caja, Â¿cuÃ¡ntos bombones le quedan en total?"}
        ],
        enero: [
          {id:"6-ene-1", t:"Sara recibe n1 euros de cada uno de sus n2 familiares por Reyes. Si ya tenÃ­a ahorrados 125 euros y gasta la cuarta parte en un videojuego, Â¿cuÃ¡nto dinero le queda?"},
          {id:"6-ene-2", t:"Pedro compra n1 juegos de mesa que cuestan n2 euros cada uno. Si paga con un billete de 100 euros, Â¿cuÃ¡nto dinero le devuelven?"},
          {id:"6-ene-3", t:"Luis tiene n1 paquetes de pegatinas con n2 pegatinas cada uno. Regala el 40% de las pegatinas. Â¿CuÃ¡ntas pegatinas regala?"}
        ],
        febrero: [
          {id:"6-feb-1", t:"Ana entrena n1 horas cada dÃ­a durante n2 dÃ­as. Si cada hora de entrenamiento quema 450 calorÃ­as, Â¿cuÃ¡ntas calorÃ­as quema en total?"},
          {id:"6-feb-2", t:"Carlos compra n1 bolsas de chuches con n2 chuches cada una. Si reparte todas las chuches equitativamente entre 18 niÃ±os, Â¿cuÃ¡ntas chuches recibe cada niÃ±o?"},
          {id:"6-feb-3", t:"MarÃ­a organiza n1 mesas para una cena con n2 personas en cada mesa. Si cada persona paga 15 euros, Â¿cuÃ¡nto dinero se recauda?"}
        ],
        marzo: [
          {id:"6-mar-1", t:"Sara planta n1 filas de lechugas con n2 lechugas en cada fila. Si cada lechuga se vende a 1,20 euros, Â¿cuÃ¡nto dinero obtendrÃ¡ si vende todas?"},
          {id:"6-mar-2", t:"Pedro tiene n1 cajas de herramientas con n2 herramientas en cada caja. Compra 12 herramientas mÃ¡s. Â¿CuÃ¡ntas herramientas tiene ahora?"},
          {id:"6-mar-3", t:"Luis recorre n1 kilÃ³metros cada dÃ­a durante n2 dÃ­as. Si su objetivo es recorrer 500 km en total, Â¿cuÃ¡ntos kilÃ³metros le faltan?"}
        ],
        abril: [
          {id:"6-abr-1", t:"Ana compra n1 paquetes de semillas con n2 semillas cada uno. Planta cinco sextas partes de las semillas. Â¿CuÃ¡ntas semillas ha plantado?"},
          {id:"6-abr-2", t:"Carlos organiza n1 grupos para una excursiÃ³n. Cada grupo tiene n2 personas. Si cada persona paga 8,50 euros, Â¿cuÃ¡nto dinero se recauda?"},
          {id:"6-abr-3", t:"MarÃ­a compra n1 libros que cuestan n2 euros cada uno. Si tiene un descuento del 25% y paga con 60 euros, Â¿cuÃ¡nto dinero le devuelven?"}
        ],
        mayo: [
          {id:"6-may-1", t:"Sara tiene n1 Ã¡lbumes de fotos con n2 fotos en cada Ã¡lbum. Si aÃ±ade 35 fotos nuevas repartidas equitativamente entre todos los Ã¡lbumes, Â¿cuÃ¡ntas fotos hay ahora en cada Ã¡lbum?"},
          {id:"6-may-2", t:"Pedro compra n1 ramos de flores con n2 flores cada uno. Cada ramo cuesta 12,75 euros. Â¿CuÃ¡nto gasta en total?"},
          {id:"6-may-3", t:"Luis tiene n1 cajas de tornillos con n2 tornillos en cada caja. Usa 3/5 de los tornillos en un proyecto. Â¿CuÃ¡ntos tornillos ha usado?"}
        ],
        junio: [
          {id:"6-jun-1", t:"Ana va n1 dÃ­as a la playa durante las vacaciones. Cada dÃ­a recoge n2 conchas y gasta 15 euros en helados. Â¿CuÃ¡ntas conchas recoge en total y cuÃ¡nto gasta en helados?"},
          {id:"6-jun-2", t:"Carlos compra n1 tablas de surf que cuestan n2 euros cada una. Si obtiene un descuento del 18%, Â¿cuÃ¡nto paga en total?"},
          {id:"6-jun-3", t:"MarÃ­a organiza n1 competiciones con n2 participantes cada una. Si cada participante paga 6,50 euros de inscripciÃ³n, Â¿cuÃ¡nto dinero se recauda en total?"}
        ]
      }
    };

    const LS_KEY = 'problemasUsados';
    let usados = {};
    try {
      usados = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
    } catch(e) {
      usados = {};
    }

    function personalizarEnunciado(base) {
      const nombres = ["Ana","Luis","MarÃ­a","Pedro","Sara","David","LucÃ­a","Carlos","Pablo","Nora","Hugo","Carmen","Javier","Elena","Diego"];
      const nombre = nombres[Math.floor(Math.random() * nombres.length)];
      
      let n1, n2;
      
      // Detectar si es un problema de resta (palabras clave: quedan, gasta, regala, se come, se escapan, venden, saca)
      const esResta = /quedan|queda|gasta|regala|se come|se escapan|escapan|venden|vende|saca/i.test(base);
      
      // Detectar si es un problema de divisiÃ³n (palabras clave: reparte, entre)
      const esDivision = /reparte.*entre|divide.*entre/i.test(base);
      
      if (esResta) {
        // Para restas: n1 debe ser mayor que n2 (mÃ­nimo 5 de diferencia para que tenga sentido)
        n1 = Math.floor(Math.random() * 15) + 10; // n1 entre 10 y 24
        n2 = Math.floor(Math.random() * (n1 - 5)) + 2; // n2 entre 2 y (n1-5), asegurando que quede algo
      } else if (esDivision) {
        // Para divisiones: n2 serÃ¡ el divisor (entre 2 y 6)
        n2 = Math.floor(Math.random() * 5) + 2; // n2 entre 2 y 6
        // n1 serÃ¡ un mÃºltiplo de n2 para que la divisiÃ³n sea exacta
        const multiplicador = Math.floor(Math.random() * 8) + 2; // multiplicador entre 2 y 9
        n1 = n2 * multiplicador;
      } else {
        // Para sumas y multiplicaciones: nÃºmeros normales
        n1 = Math.floor(Math.random() * 15) + 3; // entre 3 y 17
        n2 = Math.floor(Math.random() * 15) + 3; // entre 3 y 17
      }
      
      return base
        .replace(/n1/g, n1)
        .replace(/n2/g, n2)
        .replace(/nombre/g, nombre);
    }

    function activarDibujo() {
      document.querySelectorAll('canvas[data-draw]').forEach(canvas => {
        const ctx = canvas.getContext('2d');
        ctx.lineWidth = 4;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.strokeStyle = '#6366f1';

        let dibujando = false;
        let ultimoX = 0;
        let ultimoY = 0;

        const getPos = e => {
          const rect = canvas.getBoundingClientRect();
          const scaleX = canvas.width / rect.width;
          const scaleY = canvas.height / rect.height;
          const point = e.touches ? e.touches[0] : e;
          return { 
            x: (point.clientX - rect.left) * scaleX, 
            y: (point.clientY - rect.top) * scaleY 
          };
        };

        const start = e => { 
          e.preventDefault(); 
          dibujando = true; 
          const {x,y} = getPos(e); 
          ultimoX = x;
          ultimoY = y;
          ctx.beginPath(); 
          ctx.moveTo(x, y); 
        };

        const move = e => { 
          if(!dibujando) return; 
          e.preventDefault(); 
          const {x,y} = getPos(e); 
          ctx.lineTo(x, y); 
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(x, y);
        };

        const end = e => { 
          e.preventDefault(); 
          dibujando = false; 
        };

        canvas.addEventListener('mousedown', start);
        canvas.addEventListener('mousemove', move);
        canvas.addEventListener('mouseup', end);
        canvas.addEventListener('mouseleave', end);

        canvas.addEventListener('touchstart', start, {passive:false});
        canvas.addEventListener('touchmove', move, {passive:false});
        canvas.addEventListener('touchend', end, {passive:false});
      });
    }

    function limpiarCanvas(canvasId) {
      const canvas = document.getElementById(canvasId);
      if(canvas) {
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    }

    function generar() {
      const curso = document.getElementById('curso').value;
      const mes = document.getElementById('mes').value;
      const cantidad = parseInt(document.getElementById('numProblemas').value, 10);

      const lista = DB[curso]?.[mes];
      if (!lista || lista.length === 0) {
        document.getElementById('resultado').innerHTML =
          `<div class="bg-red-50 border-2 border-red-200 rounded-2xl p-6 text-center">
            <p class="text-red-600 font-bold text-lg">âŒ No hay problemas para esta selecciÃ³n.</p>
          </div>`;
        return;
      }

      const clave = `${curso}-${mes}`;
      if (!usados[clave]) usados[clave] = [];

      const disponibles = lista.filter(p => !usados[clave].includes(p.id));
      if (disponibles.length === 0) {
        document.getElementById('resultado').innerHTML =
          `<div class="bg-yellow-50 border-2 border-yellow-300 rounded-2xl p-6 text-center">
            <p class="text-yellow-800 font-bold text-lg">âš ï¸ Ya se han usado todos los problemas de este mes para este curso.</p>
            <p class="text-yellow-700 mt-2">No se repetirÃ¡n jamÃ¡s segÃºn la configuraciÃ³n actual.</p>
          </div>`;
        return;
      }

      const elegidos = [...disponibles].sort(() => Math.random() - 0.5).slice(0, Math.min(cantidad, disponibles.length));

      usados[clave].push(...elegidos.map(e => e.id));
      localStorage.setItem(LS_KEY, JSON.stringify(usados));

      const bloques = elegidos.map((p, i) => {
        const texto = personalizarEnunciado(p.t);
        const idBase = `problema-${i}`;
        return `
        <div class="problem-card bg-white rounded-3xl shadow-xl p-8 mb-8 border-2 border-purple-100">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-3xl font-bold text-purple-600">ğŸ¯ Problema ${i+1}</h3>
            <span class="text-sm text-gray-500 bg-gray-100 px-4 py-2 rounded-full">ID: ${p.id}</span>
          </div>
          
          <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-2xl p-6 mb-8 border-2 border-purple-200">
            <p class="text-xl leading-relaxed text-gray-800">${texto}</p>
          </div>

          <div class="space-y-6">
            <!-- Paso 1 -->
            <div class="bg-blue-50 rounded-xl p-5 border-l-4 border-blue-500">
              <div class="flex items-center mb-3">
                <span class="step-number">1</span>
                <p class="font-bold text-lg text-gray-800">Lee el problema con atenciÃ³n</p>
              </div>
              <p class="text-gray-600 ml-10">AsegÃºrate de entender quÃ© te estÃ¡n preguntando.</p>
            </div>

            <!-- Paso 2 -->
            <div class="bg-green-50 rounded-xl p-5 border-l-4 border-green-500">
              <div class="flex items-center mb-3">
                <span class="step-number">2</span>
                <p class="font-bold text-lg text-gray-800">Identifica la informaciÃ³n importante</p>
              </div>
              <p class="text-gray-600 ml-10 mb-3">Escribe los datos clave y haz dibujos si te ayuda.</p>
              <div class="canvas-container">
                <canvas id="${idBase}-canvas-2" data-draw width="1200" height="300" class="w-full rounded-lg"></canvas>
                <button onclick="limpiarCanvas('${idBase}-canvas-2')" class="mt-3 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition text-sm font-semibold">
                  ğŸ—‘ï¸ Borrar
                </button>
              </div>
            </div>

            <!-- Paso 3 -->
            <div class="bg-yellow-50 rounded-xl p-5 border-l-4 border-yellow-500">
              <div class="flex items-center mb-3">
                <span class="step-number">3</span>
                <p class="font-bold text-lg text-gray-800">Planifica la estrategia de soluciÃ³n</p>
              </div>
              <p class="text-gray-600 ml-10 mb-3">Â¿QuÃ© operaciones necesitas? Â¿Suma, resta, multiplicaciÃ³n, divisiÃ³n?</p>
              <div class="canvas-container">
                <canvas id="${idBase}-canvas-3" data-draw width="1200" height="300" class="w-full rounded-lg"></canvas>
                <button onclick="limpiarCanvas('${idBase}-canvas-3')" class="mt-3 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition text-sm font-semibold">
                  ğŸ—‘ï¸ Borrar
                </button>
              </div>
            </div>

            <!-- Paso 4 -->
            <div class="bg-purple-50 rounded-xl p-5 border-l-4 border-purple-500">
              <div class="flex items-center mb-3">
                <span class="step-number">4</span>
                <p class="font-bold text-lg text-gray-800">Realiza las operaciones</p>
              </div>
              <p class="text-gray-600 ml-10 mb-3">Calcula paso a paso y con cuidado.</p>
              <div class="canvas-container">
                <canvas id="${idBase}-canvas-4" data-draw width="1200" height="350" class="w-full rounded-lg"></canvas>
                <button onclick="limpiarCanvas('${idBase}-canvas-4')" class="mt-3 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition text-sm font-semibold">
                  ğŸ—‘ï¸ Borrar
                </button>
              </div>
            </div>

            <!-- Paso 5 -->
            <div class="bg-pink-50 rounded-xl p-5 border-l-4 border-pink-500">
              <div class="flex items-center mb-3">
                <span class="step-number">5</span>
                <p class="font-bold text-lg text-gray-800">Verifica la respuesta</p>
              </div>
              <p class="text-gray-600 ml-10 mb-3">Â¿La respuesta tiene sentido? Â¿Responde a la pregunta?</p>
              <div class="canvas-container">
                <canvas id="${idBase}-canvas-5" data-draw width="1200" height="250" class="w-full rounded-lg"></canvas>
                <button onclick="limpiarCanvas('${idBase}-canvas-5')" class="mt-3 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition text-sm font-semibold">
                  ğŸ—‘ï¸ Borrar
                </button>
              </div>
            </div>
          </div>
        </div>`;
      }).join('');

      document.getElementById('resultado').innerHTML = bloques;
      
      // PequeÃ±o delay para asegurar que los canvas estÃ©n en el DOM
      setTimeout(() => {
        activarDibujo();
      }, 100);
    }

    document.getElementById('btnGenerar').addEventListener('click', generar);
    
    document.getElementById('btnResetear').addEventListener('click', () => {
      if(confirm('Â¿EstÃ¡s seguro de que quieres resetear todos los problemas usados? Esto permitirÃ¡ que vuelvan a aparecer problemas que ya has visto.')) {
        localStorage.removeItem(LS_KEY);
        usados = {};
        alert('âœ… Problemas reseteados correctamente. Ahora puedes generar cualquier problema de nuevo.');
      }
    });
    
    // FunciÃ³n global para limpiar canvas
    window.limpiarCanvas = limpiarCanvas;
  </script>
</body>
</html>
