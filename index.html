<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Plan de Resolución de Problemas - CEIP Capitulaciones Santa Fe">
    <meta name="theme-color" content="#4F46E5">
    
    <title>Problemas Matemáticos - CEIP Capitulaciones</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="icons/icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #EFF6FF 0%, #E0E7FF 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 20px;
        }

        h1 {
            color: #1E3A8A;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #6B7280;
            margin-bottom: 20px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #E0E7FF;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        select:focus {
            outline: none;
            border-color: #4F46E5;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: #4F46E5;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #4338CA;
        }

        .btn-secondary {
            background: #10B981;
        }

        .btn-secondary:hover {
            background: #059669;
        }

        .btn-small {
            padding: 10px 20px;
            font-size: 0.95em;
            width: auto;
            margin-top: 10px;
        }

        .problem-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 20px;
        }

        .problem-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }

        .problem-number {
            background: #E0E7FF;
            color: #4F46E5;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .problem-type {
            display: inline-block;
            background: #DBEAFE;
            color: #1E40AF;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .problem-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #1F2937;
        }

        .fase {
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .fase h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .fase p {
            font-size: 0.9em;
            color: #4B5563;
            margin-bottom: 15px;
        }

        .fase-comprender {
            background: #EFF6FF;
            border: 2px solid #BFDBFE;
        }

        .fase-comprender h3 {
            color: #1E40AF;
        }

        .fase-planificar {
            background: #F5F3FF;
            border: 2px solid #DDD6FE;
        }

        .fase-planificar h3 {
            color: #6D28D9;
        }

        .fase-ejecutar {
            background: #F0FDF4;
            border: 2px solid #BBF7D0;
        }

        .fase-ejecutar h3 {
            color: #15803D;
        }

        .fase-verificar {
            background: #FFF7ED;
            border: 2px solid #FED7AA;
        }

        .fase-verificar h3 {
            color: #C2410C;
        }

        .fase-solucion {
            background: #EFF6FF;
            border: 2px solid #93C5FD;
        }

        .fase-solucion h3 {
            color: #1E40AF;
        }

        .canvas-container {
            margin-top: 10px;
        }

        .canvas-tools {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .tool-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .tool-btn.active {
            background: #4F46E5;
            color: white;
        }

        .tool-btn:not(.active) {
            background: #E5E7EB;
            color: #374151;
        }

        .tool-btn:hover {
            transform: translateY(-1px);
        }

        .tool-btn.clear {
            background: #EF4444;
            color: white;
        }

        .tool-btn.clear:hover {
            background: #DC2626;
        }

        canvas {
            border: 2px solid #D1D5DB;
            border-radius: 8px;
            cursor: crosshair;
            width: 100%;
            max-width: 600px;
            height: auto;
            touch-action: none;
        }

        .solution-box {
            background: #F0FDF4;
            border: 2px solid #86EFAC;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .solution-box h4 {
            color: #15803D;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .solution-box p {
            color: #166534;
            line-height: 1.6;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5em;
            }

            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="card">
            <h1>📚 Plan de Resolución de Problemas</h1>
            <p class="subtitle">Educación Primaria - CEIP Capitulaciones Santa Fe</p>
        </div>

        <!-- Controles -->
        <div class="card">
            <div class="controls">
                <div class="control-group">
                    <label>📖 Curso</label>
                    <select id="curso">
                        <option value="1">1º Primaria</option>
                        <option value="2">2º Primaria</option>
                        <option value="3">3º Primaria</option>
                        <option value="4">4º Primaria</option>
                        <option value="5">5º Primaria</option>
                        <option value="6">6º Primaria</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>📅 Mes</label>
                    <select id="mes">
                        <option value="octubre">Octubre</option>
                        <option value="noviembre">Noviembre</option>
                        <option value="diciembre">Diciembre</option>
                        <option value="enero">Enero</option>
                        <option value="febrero">Febrero</option>
                        <option value="marzo">Marzo</option>
                        <option value="abril">Abril</option>
                        <option value="mayo">Mayo</option>
                        <option value="junio">Junio</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>🔢 Nº Problemas</label>
                    <select id="numProblemas">
                        <option value="1">1 problema</option>
                        <option value="2">2 problemas</option>
                        <option value="3">3 problemas</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="generarProblemas()">
                💡 Generar Problemas
            </button>
        </div>

        <!-- Problemas -->
        <div id="problemasContainer">
            <div class="card empty-state">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                </svg>
                <p style="color: #6B7280; font-size: 1.1em;">
                    Selecciona el curso, mes y número de problemas, luego haz clic en "Generar Problemas"
                </p>
            </div>
        </div>
    </div>

    <script>
        // Base de datos de problemas simplificada
        const problemas = {
            '1': {
                octubre: [
                    {
                        tipo: 'Conteo y comparación',
                        plantilla: 'En la clase hay {n1} niños y {n2} niñas. ¿Cuántos estudiantes hay en total?',
                        n1: [3, 4, 5, 6],
                        n2: [2, 3, 4, 5],
                        op: 'suma'
                    },
                    {
                        tipo: 'Sumas con objetos',
                        plantilla: 'Si tengo {n1} manzanas y me dan {n2} más, ¿cuántas tengo en total?',
                        n1: [2, 3, 4, 5],
                        n2: [3, 4, 5, 6],
                        op: 'suma'
                    }
                ]
            },
            '2': {
                octubre: [
                    {
                        tipo: 'Sumas hasta 100',
                        plantilla: 'En una tienda hay {n1} juguetes y llegan {n2} más. ¿Cuántos juguetes hay ahora?',
                        n1: [25, 30, 35, 40],
                        n2: [15, 20, 25, 30],
                        op: 'suma'
                    }
                ]
            },
            '3': {
                octubre: [
                    {
                        tipo: 'Multiplicaciones',
                        plantilla: 'Si cada caja tiene {n1} lápices y hay {n2} cajas, ¿cuántos lápices hay en total?',
                        n1: [6, 7, 8, 9],
                        n2: [5, 6, 7, 8],
                        op: 'multiplicacion'
                    }
                ]
            }
        };

        let currentCanvases = {};

        function random(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function generarProblemas() {
            const curso = document.getElementById('curso').value;
            const mes = document.getElementById('mes').value;
            const numProblemas = parseInt(document.getElementById('numProblemas').value);

            const tiposDisponibles = problemas[curso]?.[mes] || problemas['1'].octubre;
            const container = document.getElementById('problemasContainer');
            container.innerHTML = '';

            for (let i = 0; i < numProblemas; i++) {
                const tipo = random(tiposDisponibles);
                const n1 = random(tipo.n1);
                const n2 = random(tipo.n2);
                const enunciado = tipo.plantilla.replace('{n1}', n1).replace('{n2}', n2);
                
                let resultado, explicacion;
                if (tipo.op === 'suma') {
                    resultado = n1 + n2;
                    explicacion = `Sumamos ${n1} + ${n2} = ${resultado}`;
                } else if (tipo.op === 'multiplicacion') {
                    resultado = n1 * n2;
                    explicacion = `Multiplicamos ${n1} × ${n2} = ${resultado}`;
                }

                crearProblema(i + 1, tipo.tipo, enunciado, explicacion, resultado);
            }
        }

        function crearProblema(num, tipo, enunciado, explicacion, resultado) {
            const container = document.getElementById('problemasContainer');
            
            const problemDiv = document.createElement('div');
            problemDiv.className = 'problem-card';
            problemDiv.id = `problema-${num}`;
            problemDiv.innerHTML = `
                <div class="problem-header">
                    <div class="problem-number">${num}</div>
                    <div style="flex: 1;">
                        <div class="problem-type">${tipo}</div>
                        <p class="problem-text">${enunciado}</p>
                    </div>
                </div>
                <button class="btn btn-small" onclick="mostrarFases(${num}, '${enunciado}', '${explicacion}', ${resultado})">
                    ✏️ Resolver Problema
                </button>
                <div id="fases-${num}" class="hidden"></div>
            `;
            
            container.appendChild(problemDiv);
        }

        function mostrarFases(num, enunciado, explicacion, resultado) {
            const fasesDiv = document.getElementById(`fases-${num}`);
            fasesDiv.className = '';
            fasesDiv.innerHTML = `
                <div style="margin-top: 20px;">
                    <div class="fase fase-comprender">
                        <h3>📖 Fase 1: Comprender</h3>
                        <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #BFDBFE;">
                            <p style="color: #1F2937; margin-bottom: 10px;"><strong>Problema:</strong> ${enunciado}</p>
                            <p style="font-size: 0.85em; color: #6B7280; font-style: italic; margin: 0;">
                                Lee atentamente el problema e identifica los datos importantes y la pregunta.
                            </p>
                        </div>
                    </div>

                    <div class="fase fase-planificar">
                        <h3>🎯 Fase 2: Planificar</h3>
                        <p>Dibuja un diagrama o esquema. Elige la estrategia para resolver el problema.</p>
                        <div class="canvas-container" id="canvas-planificar-${num}"></div>
                    </div>

                    <div class="fase fase-ejecutar">
                        <h3>⚡ Fase 3: Ejecutar</h3>
                        <p>Haz los cálculos o pasos necesarios para resolver el problema.</p>
                        <div class="canvas-container" id="canvas-ejecutar-${num}"></div>
                    </div>

                    <div class="fase fase-verificar">
                        <h3>🔍 Fase 4: Verificar</h3>
                        <p>Revisa si tu respuesta tiene sentido y si has respondido correctamente.</p>
                        <div class="canvas-container" id="canvas-verificar-${num}"></div>
                    </div>

                    <div class="fase fase-solucion">
                        <h3>✅ Fase 5: Solución Final</h3>
                        <p>Escribe tu respuesta definitiva de forma clara y completa.</p>
                        <div class="canvas-container" id="canvas-solucion-${num}"></div>
                    </div>

                    <button class="btn btn-secondary" onclick="mostrarSolucion(${num}, '${explicacion}', ${resultado})">
                        ✓ Ver Solución del Profesor
                    </button>
                    <div id="solucion-${num}" class="hidden"></div>
                </div>
            `;

            // Crear canvas para cada fase
            ['planificar', 'ejecutar', 'verificar', 'solucion'].forEach(fase => {
                crearCanvas(`canvas-${fase}-${num}`);
            });
        }

        function crearCanvas(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const canvasId = `${containerId}-canvas`;
            
            container.innerHTML = `
                <div class="canvas-tools">
                    <button class="tool-btn active" onclick="setTool('${canvasId}', 'pen')">✏️ Lápiz</button>
                    <button class="tool-btn" onclick="setTool('${canvasId}', 'eraser')">🧹 Borrador</button>
                    <button class="tool-btn clear" onclick="clearCanvas('${canvasId}')">🗑️ Limpiar</button>
                </div>
                <canvas id="${canvasId}" width="600" height="250"></canvas>
            `;

            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            currentCanvases[canvasId] = {
                canvas: canvas,
                ctx: ctx,
                drawing: false,
                tool: 'pen'
            };

            // Mouse events
            canvas.addEventListener('mousedown', (e) => startDrawing(canvasId, e));
            canvas.addEventListener('mousemove', (e) => draw(canvasId, e));
            canvas.addEventListener('mouseup', () => stopDrawing(canvasId));
            canvas.addEventListener('mouseleave', () => stopDrawing(canvasId));

            // Touch events
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });

            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });

            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                const mouseEvent = new MouseEvent('mouseup', {});
                canvas.dispatchEvent(mouseEvent);
            });
        }

        function startDrawing(canvasId, e) {
            const canvasData = currentCanvases[canvasId];
            if (!canvasData) return;

            canvasData.drawing = true;
            const rect = canvasData.canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            canvasData.ctx.beginPath();
            canvasData.ctx.moveTo(x, y);
        }

        function draw(canvasId, e) {
            const canvasData = currentCanvases[canvasId];
            if (!canvasData || !canvasData.drawing) return;

            const rect = canvasData.canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (canvasData.tool === 'pen') {
                canvasData.ctx.strokeStyle = '#1e40af';
                canvasData.ctx.lineWidth = 3;
            } else {
                canvasData.ctx.strokeStyle = 'white';
                canvasData.ctx.lineWidth = 20;
            }

            canvasData.ctx.lineCap = 'round';
            canvasData.ctx.lineJoin = 'round';
            canvasData.ctx.lineTo(x, y);
            canvasData.ctx.stroke();
        }

        function stopDrawing(canvasId) {
            const canvasData = currentCanvases[canvasId];
            if (canvasData) {
                canvasData.drawing = false;
            }
        }

        function setTool(canvasId, tool) {
            const canvasData = currentCanvases[canvasId];
            if (canvasData) {
                canvasData.tool = tool;
            }

            // Update button styles
            const container = document.getElementById(canvasId).parentElement;
            const buttons = container.querySelectorAll('.tool-btn:not(.clear)');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if ((tool === 'pen' && btn.textContent.includes('Lápiz')) ||
                    (tool === 'eraser' && btn.textContent.includes('Borrador'))) {
                    btn.classList.add('active');
                }
            });
        }

        function clearCanvas(canvasId) {
            const canvasData = currentCanvases[canvasId];
            if (canvasData) {
                canvasData.ctx.fillStyle = 'white';
                canvasData.ctx.fillRect(0, 0, canvasData.canvas.width, canvasData.canvas.height);
            }
        }

        function mostrarSolucion(num, explicacion, resultado) {
            const solucionDiv = document.getElementById(`solucion-${num}`);
            solucionDiv.className = 'solution-box';
            solucionDiv.innerHTML = `
                <h4>💡 Explicación:</h4>
                <p>${explicacion}</p>
                <h4 style="margin-top: 15px;">✅ Solución:</h4>
                <p><strong>Resultado: ${resultado}</strong></p>
            `;
        }

        console.log('✅ App cargada correctamente');
    </script>
</body>
</html>
