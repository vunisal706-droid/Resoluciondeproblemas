<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö Generador de Problemas Matem√°ticos - Primaria</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const { BookOpen, Calendar, Hash, Lightbulb, Check, Pencil, Eraser, Trash2 } = lucide;

        const DrawingCanvas = ({ faseId, problemaId }) => {
            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);
            const [tool, setTool] = useState('pencil');
            const [color, setColor] = useState('#000000');
            const [lineWidth, setLineWidth] = useState(3);

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }, []);

            const getCoordinates = (e, canvas) => {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;

                if (e.type.includes('mouse')) {
                    return {
                        x: (e.clientX - rect.left) * scaleX,
                        y: (e.clientY - rect.top) * scaleY
                    };
                } else {
                    return {
                        x: (e.touches[0].clientX - rect.left) * scaleX,
                        y: (e.touches[0].clientY - rect.top) * scaleY
                    };
                }
            };

            const startDrawing = (e) => {
                e.preventDefault();
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const { x, y } = getCoordinates(e, canvas);

                setIsDrawing(true);
                ctx.beginPath();
                ctx.moveTo(x, y);
            };

            const draw = (e) => {
                if (!isDrawing) return;
                e.preventDefault();

                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const { x, y } = getCoordinates(e, canvas);

                if (tool === 'eraser') {
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = lineWidth * 3;
                } else {
                    ctx.strokeStyle = color;
                    ctx.lineWidth = lineWidth;
                }

                ctx.lineTo(x, y);
                ctx.stroke();
            };

            const stopDrawing = () => {
                setIsDrawing(false);
            };

            const clearCanvas = () => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            };

            const colors = ['#000000', '#FF0000', '#0000FF', '#00AA00', '#FFA500', '#800080'];
            const widths = [2, 3, 5, 8];

            return (
                <div className="space-y-3">
                    <div className="flex flex-wrap gap-2 items-center bg-gray-100 p-3 rounded-lg">
                        <div className="flex gap-2">
                            <button
                                onClick={() => setTool('pencil')}
                                className={`p-2 rounded-lg transition-colors ${
                                    tool === 'pencil' 
                                        ? 'bg-indigo-600 text-white' 
                                        : 'bg-white text-gray-700 hover:bg-gray-200'
                                }`}
                                title="L√°piz"
                            >
                                <Pencil size={20} />
                            </button>
                            <button
                                onClick={() => setTool('eraser')}
                                className={`p-2 rounded-lg transition-colors ${
                                    tool === 'eraser' 
                                        ? 'bg-indigo-600 text-white' 
                                        : 'bg-white text-gray-700 hover:bg-gray-200'
                                }`}
                                title="Borrador"
                            >
                                <Eraser size={20} />
                            </button>
                            <button
                                onClick={clearCanvas}
                                className="p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors"
                                title="Limpiar todo"
                            >
                                <Trash2 size={20} />
                            </button>
                        </div>

                        <div className="flex gap-2 ml-2 flex-wrap">
                            {colors.map(c => (
                                <button
                                    key={c}
                                    onClick={() => { setColor(c); setTool('pencil'); }}
                                    className={`w-8 h-8 rounded-full border-2 transition-transform ${
                                        color === c && tool === 'pencil' 
                                            ? 'border-gray-800 scale-110' 
                                            : 'border-gray-300'
                                    }`}
                                    style={{ backgroundColor: c }}
                                    title="Color"
                                />
                            ))}
                        </div>

                        <div className="flex gap-2 ml-2 flex-wrap">
                            {widths.map(w => (
                                <button
                                    key={w}
                                    onClick={() => { setLineWidth(w); setTool('pencil'); }}
                                    className={`p-2 rounded-lg transition-colors flex items-center justify-center ${
                                        lineWidth === w && tool === 'pencil'
                                            ? 'bg-indigo-600 text-white'
                                            : 'bg-white text-gray-700 hover:bg-gray-200'
                                    }`}
                                    title={`Grosor ${w}px`}
                                    style={{ width: '40px', height: '40px' }}
                                >
                                    <div 
                                        style={{ 
                                            width: `${w * 2}px`, 
                                            height: `${w * 2}px`, 
                                            backgroundColor: 'currentColor',
                                            borderRadius: '50%'
                                        }}
                                    />
                                </button>
                            ))}
                        </div>
                    </div>

                    <canvas
                        ref={canvasRef}
                        width={800}
                        height={400}
                        onMouseDown={startDrawing}
                        onMouseMove={draw}
                        onMouseUp={stopDrawing}
                        onMouseLeave={stopDrawing}
                        onTouchStart={startDrawing}
                        onTouchMove={draw}
                        onTouchEnd={stopDrawing}
                        className="border-2 border-gray-300 rounded-lg cursor-crosshair w-full touch-none bg-white"
                        style={{ maxWidth: '100%', height: 'auto', minHeight: '300px' }}
                    />
                </div>
            );
        };

        const ProblemasGenerator = () => {
            const [curso, setCurso] = useState('1');
            const [mes, setMes] = useState('octubre');
            const [numProblemas, setNumProblemas] = useState(1);
            const [problemasGenerados, setProblemasGenerados] = useState([]);
            const [mostrarSoluciones, setMostrarSoluciones] = useState({});
            const [respuestasAlumno, setRespuestasAlumno] = useState({});

            const meses = [
                'octubre', 'noviembre', 'diciembre', 'enero',
                'febrero', 'marzo', 'abril', 'mayo', 'junio'
            ];

            const tiposProblemas = {
                '1': {
                    octubre: [
                        { tipo: 'Conteo y comparaci√≥n', ejemplo: '¬øCu√°ntos l√°pices hay si tienes {n1} rojos y {n2} azules?', n1: [3, 4, 5, 6], n2: [2, 3, 4, 5], op: 'suma' },
                        { tipo: 'Sumas con objetos', ejemplo: 'Si tengo {n1} manzanas y me dan {n2} m√°s, ¬øcu√°ntas tengo en total?', n1: [2, 3, 4, 5], n2: [3, 4, 5, 6], op: 'suma' }
                    ],
                    noviembre: [
                        { tipo: 'Ubicaci√≥n espacial', ejemplo: 'Coloca {n1} juguetes dentro de la caja y {n2} fuera. ¬øCu√°ntos juguetes tienes en total?', n1: [3, 4, 5, 6], n2: [2, 3, 4], op: 'suma' },
                        { tipo: 'Quitar objetos', ejemplo: 'Tienes {n1} caramelos y te comes {n2}. ¬øCu√°ntos te quedan?', n1: [8, 9, 10], n2: [2, 3, 4], op: 'resta' }
                    ],
                    diciembre: [
                        { tipo: 'Comparaci√≥n', ejemplo: '¬øQu√© grupo tiene m√°s: {n1} caramelos o {n2} caramelos?', n1: [6, 7, 8], n2: [4, 5, 6], op: 'comparar' },
                        { tipo: 'Mayor o menor', ejemplo: '¬øCu√°l es mayor, {n1} o {n2}?', n1: [5, 7, 9], n2: [3, 6, 8], op: 'comparar' }
                    ],
                    enero: [
                        { tipo: 'Sumas y restas hasta 20', ejemplo: 'Si tienes {n1} caramelos y te comes {n2}, ¬øcu√°ntos te quedan?', n1: [15, 16, 18, 20], n2: [3, 4, 5, 6], op: 'resta' },
                        { tipo: 'Patrones', ejemplo: 'Completa la serie: 2, 4, 6, ___, ___', n1: [8], n2: [10], op: 'patron' }
                    ],
                    febrero: [
                        { tipo: 'Conteo hasta 20', ejemplo: 'Cuenta cu√°ntos objetos hay en total si tienes {n1} y {n2}', n1: [7, 8, 9, 10], n2: [5, 6, 7, 8], op: 'suma' },
                        { tipo: 'Objetos perdidos', ejemplo: 'Ten√≠as {n1} globos y se te escapan {n2}. ¬øCu√°ntos te quedan?', n1: [15, 17, 19], n2: [4, 6, 8], op: 'resta' }
                    ],
                    marzo: [
                        { tipo: 'Clasificaci√≥n', ejemplo: 'Tienes {n1} juguetes rojos y {n2} azules. ¬øCu√°ntos juguetes tienes en total?', n1: [6, 7, 8], n2: [5, 6, 7], op: 'suma' }
                    ],
                    abril: [
                        { tipo: 'Sumas manipulativas', ejemplo: 'Tienes {n1} bloques y te dan {n2} m√°s. ¬øCu√°ntos bloques tienes ahora?', n1: [6, 7, 8], n2: [3, 4, 5], op: 'suma' }
                    ],
                    mayo: [
                        { tipo: 'Series num√©ricas', ejemplo: 'Completa la serie: 1, 3, 5, ___, ___', n1: [7], n2: [9], op: 'patron' }
                    ],
                    junio: [
                        { tipo: 'Sumas hasta 20', ejemplo: 'Tienes {n1} caramelos y te comes {n2}. ¬øCu√°ntos caramelos te quedan?', n1: [12, 15, 18, 20], n2: [4, 5, 6, 7], op: 'resta' }
                    ]
                },
                '2': {
                    octubre: [
                        { tipo: 'Sumas y restas hasta 20', ejemplo: 'Si tienes {n1} manzanas y regalas {n2}, ¬øcu√°ntas te quedan?', n1: [14, 16, 18, 20], n2: [6, 7, 8, 9], op: 'resta' }
                    ],
                    noviembre: [
                        { tipo: 'Multiplicaci√≥n inicial', ejemplo: 'Si hay {n1} cajas con {n2} juguetes cada una, ¬øcu√°ntos juguetes hay en total?', n1: [3, 4, 5], n2: [3, 4, 5], op: 'multi' }
                    ],
                    diciembre: [
                        { tipo: 'Dinero', ejemplo: 'Tienes {n1} c√©ntimos y compras un chicle por {n2} c√©ntimos. ¬øCu√°nto te queda?', n1: [30, 40, 50, 60], n2: [15, 20, 25], op: 'resta' }
                    ],
                    enero: [
                        { tipo: 'Multiplicaci√≥n', ejemplo: 'Si cada d√≠a comes {n1} frutas durante {n2} d√≠as, ¬øcu√°ntas frutas has comido en total?', n1: [3, 4, 5], n2: [4, 5, 6], op: 'multi' }
                    ],
                    febrero: [
                        { tipo: 'Medidas', ejemplo: 'Si una cuerda mide {n1} metros y otra mide {n2} metros, ¬øcu√°l es m√°s larga?', n1: [2, 3, 4], n2: [3, 4, 5], op: 'comparar' }
                    ],
                    marzo: [
                        { tipo: 'Fracciones', ejemplo: 'Si tienes una pizza y la divides en {n1} partes iguales, ¬øcu√°ntas partes tendr√°s?', n1: [4, 6, 8], op: 'fraccion' }
                    ],
                    abril: [
                        { tipo: 'Multiplicaci√≥n cotidiana', ejemplo: 'Si hay {n1} cajas con {n2} manzanas cada una, ¬øcu√°ntas manzanas hay en total?', n1: [5, 6, 7], n2: [6, 7, 8], op: 'multi' }
                    ],
                    mayo: [
                        { tipo: 'Medidas', ejemplo: 'Si un jugo tiene 1 litro y bebes {n1} ml, ¬øcu√°nto queda en ml?', n1: [500, 250, 750], op: 'resta' }
                    ],
                    junio: [
                        { tipo: 'Patrones', ejemplo: 'Completa la serie: 2, 4, 6, ___, ___', n1: [8], n2: [10], op: 'patron' }
                    ]
                },
                '3': {
                    octubre: [
                        { tipo: 'Sumas y restas hasta 100', ejemplo: 'Tienes {n1} puntos y pierdes {n2}. ¬øCu√°ntos puntos te quedan?', n1: [75, 85, 90, 95], n2: [35, 40, 45, 50], op: 'resta' }
                    ],
                    noviembre: [
                        { tipo: 'Divisi√≥n reparto', ejemplo: 'Reparte {n1} caramelos entre {n2} ni√±os. ¬øCu√°ntos le toca a cada uno?', n1: [20, 24, 30], n2: [4, 5, 6], op: 'div' }
                    ],
                    diciembre: [
                        { tipo: 'Fracciones', ejemplo: 'Si partes una barra de chocolate en {n1} y te comes {n2}, ¬øqu√© fracci√≥n queda?', n1: [4, 8], n2: [2, 3], op: 'fraccion' }
                    ],
                    enero: [
                        { tipo: 'Multiplicaci√≥n tablas 6-10', ejemplo: 'Si hay {n1} canastas y en cada una hay {n2} pelotas, ¬øcu√°ntas pelotas hay en total?', n1: [6, 7, 8], n2: [4, 5, 6], op: 'multi' }
                    ],
                    febrero: [
                        { tipo: 'Fracciones cotidianas', ejemplo: 'Si compartes una pizza entre {n1} personas y comes {n2} partes, ¬øqu√© fracci√≥n has comido?', n1: [5, 6, 8], n2: [2, 3], op: 'fraccion' }
                    ],
                    marzo: [
                        { tipo: 'Per√≠metro', ejemplo: 'Calcula el per√≠metro de un cuadrado con lados de {n1} cm', n1: [5, 6, 7, 8], op: 'perimetro' }
                    ],
                    abril: [
                        { tipo: 'Decimales', ejemplo: 'Si compras una barra de pan por {n1} ‚Ç¨, ¬øcu√°nto pagar√°s por {n2} barras?', n1: [1.25, 1.50, 1.75], n2: [3, 4, 5], op: 'multi' }
                    ],
                    mayo: [
                        { tipo: 'Multiplicaci√≥n y divisi√≥n', ejemplo: 'Si tienes {n1} caramelos y los divides entre {n2} amigos, ¬øcu√°ntos caramelos recibe cada uno?', n1: [48, 56, 64], n2: [4, 8], op: 'div' }
                    ],
                    junio: [
                        { tipo: 'Patrones', ejemplo: 'Completa la serie: 5, 10, 15, ___, ___', n1: [20], n2: [25], op: 'patron' }
                    ]
                },
                '4': {
                    octubre: [
                        { tipo: 'Operaciones hasta 1000', ejemplo: 'Tienes {n1} puntos y pierdes {n2}. ¬øCu√°ntos te quedan?', n1: [860, 920, 750], n2: [350, 420, 280], op: 'resta' }
                    ],
                    noviembre: [
                        { tipo: 'Divisi√≥n 2 cifras', ejemplo: 'Si tienes {n1} caramelos y los repartes entre {n2} ni√±os, ¬øcu√°ntos caramelos recibe cada uno?', n1: [120, 144, 180], n2: [6, 8, 9], op: 'div' }
                    ],
                    diciembre: [
                        { tipo: 'Dinero', ejemplo: 'Si compras un libro por {n1} ‚Ç¨ y pagas con {n2} ‚Ç¨, ¬øcu√°nto te devuelven?', n1: [18, 24, 32], n2: [50], op: 'resta' }
                    ],
                    enero: [
                        { tipo: '√Årea', ejemplo: 'Calcula el √°rea de un rect√°ngulo de {n1} cm por {n2} cm', n1: [8, 10, 12], n2: [5, 6, 7], op: 'area' }
                    ],
                    febrero: [
                        { tipo: 'Decimales', ejemplo: 'Si compras {n1} kg de naranjas a {n2} ‚Ç¨ el kilo, ¬øcu√°nto pagas?', n1: [2.5, 3.5, 4.5], n2: [1.80, 2.20, 2.50], op: 'multi' }
                    ],
                    marzo: [
                        { tipo: 'Geometr√≠a', ejemplo: 'Calcula el per√≠metro de un rect√°ngulo de {n1} cm por {n2} cm', n1: [12, 15, 18], n2: [7, 8, 9], op: 'perimetro' }
                    ],
                    abril: [
                        { tipo: 'Proporcionalidad', ejemplo: 'Si {n1} l√°pices cuestan {n2} ‚Ç¨, ¬øcu√°nto costar√°n {n3} l√°pices?', n1: [3, 4, 5], n2: [6, 8, 10], n3: [9, 12, 15], op: 'proporcion' }
                    ],
                    mayo: [
                        { tipo: 'Problemas combinados', ejemplo: 'Compras {n1} libros a {n2} ‚Ç¨ cada uno y pagas con {n3} ‚Ç¨. ¬øCu√°nto te devuelven?', n1: [3, 4, 5], n2: [8, 12, 15], n3: [50, 100], op: 'combinado' }
                    ],
                    junio: [
                        { tipo: 'Estad√≠stica', ejemplo: 'Las notas de la clase son: {n1}, {n2}, {n3}. ¬øCu√°l es la media?', n1: [7, 8], n2: [9, 10], n3: [6, 7], op: 'media' }
                    ]
                },
                '5': {
                    octubre: [
                        { tipo: 'Operaciones combinadas', ejemplo: 'Calcula: {n1} + {n2} √ó {n3}', n1: [15, 20, 25], n2: [3, 4, 5], n3: [5, 6, 7], op: 'combinado' }
                    ],
                    noviembre: [
                        { tipo: 'Decimales', ejemplo: 'Multiplica {n1} √ó {n2}', n1: [3.5, 4.2, 5.1], n2: [2.4, 3.1, 2.5], op: 'multi' }
                    ],
                    diciembre: [
                        { tipo: '√Årea tri√°ngulo', ejemplo: 'Calcula el √°rea de un tri√°ngulo con base {n1} cm y altura {n2} cm', n1: [8, 10, 12], n2: [6, 8, 10], op: 'area' }
                    ],
                    enero: [
                        { tipo: 'Velocidad', ejemplo: 'Un coche viaja a {n1} km/h durante {n2} horas. ¬øQu√© distancia recorre?', n1: [80, 100, 120], n2: [2.5, 3.5, 4], op: 'velocidad' }
                    ],
                    febrero: [
                        { tipo: 'Fracciones complejas', ejemplo: 'Multiplica {n1}/{n2} √ó {n3}/{n4}', n1: [2, 3], n2: [3, 4], n3: [4, 5], n4: [5, 6], op: 'fraccion' }
                    ],
                    marzo: [
                        { tipo: 'C√≠rculo', ejemplo: 'Si un c√≠rculo tiene radio {n1} cm, ¬øcu√°l es su √°rea? (usa œÄ = 3.14)', n1: [5, 6, 7], op: 'circulo' }
                    ],
                    abril: [
                        { tipo: 'Potencias', ejemplo: 'Calcula {n1}¬≤', n1: [12, 15, 18], op: 'potencia' }
                    ],
                    mayo: [
                        { tipo: 'Ecuaciones simples', ejemplo: 'Resuelve: x + {n1} = {n2}', n1: [15, 20, 25], n2: [35, 45, 50], op: 'ecuacion' }
                    ],
                    junio: [
                        { tipo: 'Probabilidad', ejemplo: 'Si lanzas un dado, ¬øqu√© probabilidad hay de sacar un n√∫mero par?', op: 'probabilidad' }
                    ]
                },
                '6': {
                    octubre: [
                        { tipo: 'Operaciones complejas', ejemplo: 'Calcula: ({n1} + {n2}) √ó {n3} - {n4}', n1: [25, 30], n2: [15, 20], n3: [3, 4], n4: [20, 30], op: 'combinado' }
                    ],
                    noviembre: [
                        { tipo: 'Porcentajes avanzados', ejemplo: 'Un art√≠culo de {n1} ‚Ç¨ tiene un descuento del {n2}%. ¬øCu√°l es el precio final?', n1: [80, 120], n2: [15, 25], op: 'porcentaje' }
                    ],
                    diciembre: [
                        { tipo: 'Volumen cilindro', ejemplo: 'Calcula el volumen de un cilindro con radio {n1} cm y altura {n2} cm (œÄ = 3.14)', n1: [4, 5], n2: [10, 12], op: 'volumen' }
                    ],
                    enero: [
                        { tipo: 'Ecuaciones', ejemplo: 'Resuelve: {n1}x + {n2} = {n3}', n1: [3, 4], n2: [15, 20], n3: [30, 40], op: 'ecuacion' }
                    ],
                    febrero: [
                        { tipo: 'N√∫meros enteros', ejemplo: 'Calcula: {n1} - ({n2}) + ({n3})', n1: [15, 20], n2: [-8, -10], n3: [-5, -7], op: 'enteros' }
                    ],
                    marzo: [
                        { tipo: 'Escalas', ejemplo: 'En un mapa a escala 1:{n1}, ¬øcu√°ntos km reales son {n2} cm del mapa?', n1: [100000, 200000], n2: [5, 8], op: 'escala' }
                    ],
                    abril: [
                        { tipo: 'Sistema de ecuaciones', ejemplo: 'Resuelve: x + y = {n1} y x - y = {n2}', n1: [20, 30], n2: [4, 6], op: 'sistema' }
                    ],
                    mayo: [
                        { tipo: 'Estad√≠stica avanzada', ejemplo: 'Calcula la mediana de: {n1}, {n2}, {n3}, {n4}, {n5}', n1: [12, 15], n2: [18, 20], n3: [14, 16], n4: [10, 12], n5: [22, 25], op: 'estadistica' }
                    ],
                    junio: [
                        { tipo: 'Probabilidad compuesta', ejemplo: 'Al lanzar dos dados, ¬øqu√© probabilidad hay de que sumen {n1}?', n1: [7, 8], op: 'probabilidad' }
                    ]
                }
            };

            const generarNumero = (array) => {
                return array[Math.floor(Math.random() * array.length)];
            };

            const generarEnunciado = (plantilla) => {
                let enunciado = plantilla.ejemplo;
                const numeros = {};

                if (plantilla.n1) {
                    numeros.n1 = generarNumero(plantilla.n1);
                    enunciado = enunciado.replace('{n1}', numeros.n1);
                }
                if (plantilla.n2) {
                    numeros.n2 = generarNumero(plantilla.n2);
                    enunciado = enunciado.replace('{n2}', numeros.n2);
                }
                if (plantilla.n3) {
                    numeros.n3 = generarNumero(plantilla.n3);
                    enunciado = enunciado.replace('{n3}', numeros.n3);
                }
                if (plantilla.n4) {
                    numeros.n4 = generarNumero(plantilla.n4);
                    enunciado = enunciado.replace('{n4}', numeros.n4);
                }
                if (plantilla.n5) {
                    numeros.n5 = generarNumero(plantilla.n5);
                    enunciado = enunciado.replace('{n5}', numeros.n5);
                }

                return { enunciado, numeros, tipo: plantilla.tipo, op: plantilla.op };
            };

            const calcularSolucion = (numeros, op) => {
                const { n1, n2, n3, n4 } = numeros;

                switch (op) {
                    case 'suma':
                        return { resultado: n1 + n2, explicacion: `Sumamos ${n1} + ${n2}` };
                    case 'resta':
                        return { resultado: n1 - n2, explicacion: `Restamos ${n1} - ${n2}` };
                    case 'multi':
                        return { resultado: n1 * (n2 || 1), explicacion: `Multiplicamos ${n1} √ó ${n2 || 1}` };
                    case 'div':
                        return { resultado: Math.floor(n1 / n2), explicacion: `Dividimos ${n1} √∑ ${n2}` };
                    case 'comparar':
                        return { resultado: n1 > n2 ? `${n1} es mayor` : `${n2} es mayor`, explicacion: `Comparamos ${n1} y ${n2}` };
                    case 'patron':
                        return { resultado: `${n1}, ${n2}`, explicacion: 'Seguimos el patr√≥n de la serie' };
                    case 'fraccion':
                        if (n2) {
                            return { resultado: `${n2 - n1}/${n2}`, explicacion: `De ${n2} partes quedan ${n2 - n1}` };
                        }
                        return { resultado: `${n1} partes`, explicacion: `Dividimos en ${n1} partes iguales` };
                    case 'area':
                        return { resultado: n1 * n2, explicacion: `√Årea = base √ó altura = ${n1} √ó ${n2}` };
                    case 'perimetro':
                        if (n2) {
                            return { resultado: 2 * (n1 + n2), explicacion: `Per√≠metro = 2 √ó (${n1} + ${n2})` };
                        }
                        return { resultado: 4 * n1, explicacion: `Per√≠metro = 4 √ó ${n1}` };
                    case 'porcentaje':
                        return { resultado: (n1 * n2) / 100, explicacion: `${n1}% de ${n2} = (${n1} √ó ${n2}) √∑ 100` };
                    case 'combinado':
                        if (n3 && n4) {
                            return { resultado: (n1 + n2) * n3 - n4, explicacion: `(${n1} + ${n2}) √ó ${n3} - ${n4}` };
                        }
                        return { resultado: n1 + n2 * n3, explicacion: `${n1} + ${n2} √ó ${n3}` };
                    case 'velocidad':
                        return { resultado: n1 * n2, explicacion: `Distancia = velocidad √ó tiempo = ${n1} √ó ${n2}` };
                    case 'proporcion':
                        return { resultado: (n2 * n3) / n1, explicacion: `Regla de tres: ${n1}‚Üí${n2}, ${n3}‚Üí?` };
                    case 'volumen':
                        return { resultado: n1 * n1 * n1, explicacion: `Volumen = ${n1}¬≥ = ${n1 * n1 * n1}` };
                    case 'potencia':
                        return { resultado: n1 * n1, explicacion: `${n1}¬≤ = ${n1 * n1}` };
                    case 'ecuacion':
                        return { resultado: n2 - n1, explicacion: `x = ${n2} - ${n1}` };
                    case 'circulo':
                        return { resultado: (3.14 * n1 * n1).toFixed(2), explicacion: `√Årea = œÄ √ó r¬≤ = 3.14 √ó ${n1}¬≤` };
                    case 'media':
                        const suma = n1 + n2 + n3;
                        return { resultado: (suma / 3).toFixed(2), explicacion: `Media = (${n1} + ${n2} + ${n3}) √∑ 3` };
                    case 'sistema':
                        const x = (n1 + n2) / 2;
                        const y = (n1 - n2) / 2;
                        return { resultado: `x = ${x}, y = ${y}`, explicacion: `Resolviendo el sistema: x = ${x}, y = ${y}` };
                    case 'enteros':
                        return { resultado: n1 - n2 + n3, explicacion: `${n1} - (${n2}) + (${n3})` };
                    case 'escala':
                        return { resultado: (n1 * n2) / 100000, explicacion: `${n2} cm √ó ${n1} = ${(n1 * n2) / 100000} km` };
                    case 'estadistica':
                        const valores = [n1, n2, n3, n4, n5 || 0].filter(v => v > 0);
                        const sumaVal = valores.reduce((a, b) => a + b, 0);
                        return { resultado: (sumaVal / valores.length).toFixed(2), explicacion: `Media de los valores` };
                    default:
                        return { resultado: 'Respuesta abierta', explicacion: 'Resuelve seg√∫n lo que has aprendido' };
                }
            };

            const handleGenerar = () => {
                const plantillas = tiposProblemas[curso]?.[mes] || [];
                if (plantillas.length === 0) {
                    alert('No hay problemas disponibles para esta combinaci√≥n');
                    return;
                }

                const nuevosProblemas = [];
                for (let i = 0; i < numProblemas; i++) {
                    const plantilla = plantillas[Math.floor(Math.random() * plantillas.length)];
                    const { enunciado, numeros, tipo, op } = generarEnunciado(plantilla);
                    const { resultado, explicacion } = calcularSolucion(numeros, op);

                    nuevosProblemas.push({
                        enunciado,
                        tipo,
                        solucion: resultado.toString(),
                        explicacion
                    });
                }

                setProblemasGenerados(nuevosProblemas);
                setMostrarSoluciones({});
                setRespuestasAlumno({});
            };

            const toggleSolucion = (index) => {
                setMostrarSoluciones(prev => ({
                    ...prev,
                    [index]: !prev[index]
                }));
            };

            const handleRespuestaChange = (problemaIndex, fase, valor) => {
                setRespuestasAlumno(prev => ({
                    ...prev,
                    [`${problemaIndex}-${fase}`]: valor
                }));
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 py-8 px-4">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl shadow-2xl p-8 mb-8 text-white">
                            <h1 className="text-4xl font-bold mb-3 text-center">
                                üìö Generador de Problemas Matem√°ticos
                            </h1>
                            <p className="text-center text-xl opacity-90">
                                Educaci√≥n Primaria - Curso 2025/2026
                            </p>
                            <p className="text-center text-sm mt-2 opacity-75">
                                üéØ Con 5 fases de resoluci√≥n y pizarra digital interactiva
                            </p>
                        </div>

                        <div className="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        <BookOpen size={16} className="inline mr-1" />
                                        Curso
                                    </label>
                                    <select
                                        value={curso}
                                        onChange={(e) => setCurso(e.target.value)}
                                        className="w-full p-3 border-2 border-indigo-200 rounded-lg focus:border-indigo-500 focus:outline-none"
                                    >
                                        <option value="1">1¬∫ Primaria</option>
                                        <option value="2">2¬∫ Primaria</option>
                                        <option value="3">3¬∫ Primaria</option>
                                        <option value="4">4¬∫ Primaria</option>
                                        <option value="5">5¬∫ Primaria</option>
                                        <option value="6">6¬∫ Primaria</option>
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        <Calendar size={16} className="inline mr-1" />
                                        Mes
                                    </label>
                                    <select
                                        value={mes}
                                        onChange={(e) => setMes(e.target.value)}
                                        className="w-full p-3 border-2 border-indigo-200 rounded-lg focus:border-indigo-500 focus:outline-none"
                                    >
                                        {meses.map(m => (
                                            <option key={m} value={m}>
                                                {m.charAt(0).toUpperCase() + m.slice(1)}
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        <Hash size={16} className="inline mr-1" />
                                        N¬∫ Problemas
                                    </label>
                                    <select
                                        value={numProblemas}
                                        onChange={(e) => setNumProblemas(parseInt(e.target.value))}
                                        className="w-full p-3 border-2 border-indigo-200 rounded-lg focus:border-indigo-500 focus:outline-none"
                                    >
                                        <option value={1}>1 problema</option>
                                        <option value={2}>2 problemas</option>
                                        <option value={3}>3 problemas</option>
                                    </select>
                                </div>
                            </div>

                            <button
                                onClick={handleGenerar}
                                className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2"
                            >
                                <Lightbulb size={20} />
                                Generar Problemas
                            </button>
                        </div>

                        {problemasGenerados.length > 0 && (
                            <div className="space-y-8">
                                {problemasGenerados.map((problema, index) => (
                                    <div key={index} className="bg-white rounded-xl shadow-lg overflow-hidden">
                                        <div className="bg-gradient-to-r from-indigo-500 to-purple-500 p-6">
                                            <div className="flex items-start gap-3">
                                                <div className="bg-white text-indigo-700 font-bold rounded-full w-10 h-10 flex items-center justify-center flex-shrink-0 text-lg">
                                                    {index + 1}
                                                </div>
                                                <div className="flex-1">
                                                    <span className="inline-block bg-white/20 text-white text-xs font-semibold px-3 py-1 rounded-full mb-2">
                                                        {problema.tipo}
                                                    </span>
                                                    <p className="text-xl text-white leading-relaxed font-medium">
                                                        {problema.enunciado}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="p-6 space-y-6">
                                            <div className="border-2 border-blue-300 rounded-lg p-5 bg-blue-50">
                                                <h3 className="text-lg font-bold text-blue-900 mb-3 flex items-center gap-2">
                                                    <span className="bg-blue-500 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm">1</span>
                                                    üìñ COMPRENDER
                                                </h3>
                                                <p className="text-blue-700 text-sm mb-2">Leer el problema, anotar datos y pregunta</p>
                                                <textarea
                                                    value={respuestasAlumno[`${index}-comprender`] || ''}
                                                    onChange={(e) => handleRespuestaChange(index, 'comprender', e.target.value)}
                                                    placeholder="Escribe aqu√≠ los datos importantes y qu√© te preguntan..."
                                                    className="w-full p-3 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none min-h-[100px] resize-y"
                                                />
                                            </div>

                                            <div className="border-2 border-green-300 rounded-lg p-5 bg-green-50">
                                                <h3 className="text-lg font-bold text-green-900 mb-3 flex items-center gap-2">
                                                    <span className="bg-green-500 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm">2</span>
                                                    üìã PLANIFICAR
                                                </h3>
                                                <p className="text-green-700 text-sm mb-3">Elegir c√≥mo resolverlo (estrategia)</p>
                                                <DrawingCanvas faseId="planificar" problemaId={index} />
                                            </div>

                                            <div className="border-2 border-orange-300 rounded-lg p-5 bg-orange-50">
                                                <h3 className="text-lg font-bold text-orange-900 mb-3 flex items-center gap-2">
                                                    <span className="bg-orange-500 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm">3</span>
                                                    ‚úèÔ∏è EJECUTAR
                                                </h3>
                                                <p className="text-orange-700 text-sm mb-3">Hacer los c√°lculos o pasos</p>
                                                <DrawingCanvas faseId="ejecutar" problemaId={index} />
                                            </div>

                                            <div className="border-2 border-purple-300 rounded-lg p-5 bg-purple-50">
                                                <h3 className="text-lg font-bold text-purple-900 mb-3 flex items-center gap-2">
                                                    <span className="bg-purple-500 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm">4</span>
                                                    ‚úÖ VERIFICAR
                                                </h3>
                                                <p className="text-purple-700 text-sm mb-3">Revisar si la respuesta tiene sentido</p>
                                                <DrawingCanvas faseId="verificar" problemaId={index} />
                                            </div>

                                            <div className="border-2 border-pink-300 rounded-lg p-5 bg-pink-50">
                                                <h3 className="text-lg font-bold text-pink-900 mb-3 flex items-center gap-2">
                                                    <span className="bg-pink-500 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm">5</span>
                                                    üéØ SOLUCI√ìN FINAL
                                                </h3>
                                                <p className="text-pink-700 text-sm mb-2">Escribir el resultado definitivo</p>
                                                <textarea
                                                    value={respuestasAlumno[`${index}-solucion`] || ''}
                                                    onChange={(e) => handleRespuestaChange(index, 'solucion', e.target.value)}
                                                    placeholder="Escribe aqu√≠ tu respuesta final completa..."
                                                    className="w-full p-3 border-2 border-pink-300 rounded-lg focus:border-pink-500 focus:outline-none min-h-[80px] resize-y"
                                                />
                                            </div>
                                        </div>

                                        <div className="p-6 pt-0">
                                            <button
                                                onClick={() => toggleSolucion(index)}
                                                className="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2"
                                            >
                                                <Check size={20} />
                                                {mostrarSoluciones[index] ? 'Ocultar' : 'Ver'} Soluci√≥n del Profesor
                                            </button>

                                            {mostrarSoluciones[index] && (
                                                <div className="mt-4 p-5 bg-green-50 border-2 border-green-200 rounded-lg">
                                                    <div className="mb-3">
                                                        <h3 className="text-green-900 font-bold text-lg mb-2 flex items-center gap-2">
                                                            <Lightbulb size={20} />
                                                            Explicaci√≥n:
                                                        </h3>
                                                        <p className="text-green-800 leading-relaxed">
                                                            {problema.explicacion}
                                                        </p>
                                                    </div>
                                                    <div className="pt-3 border-t-2 border-green-200">
                                                        <h3 className="text-green-900 font-bold text-lg mb-2 flex items-center gap-2">
                                                            <Check size={20} />
                                                            Soluci√≥n:
                                                        </h3>
                                                        <p className="text-green-800 font-semibold text-xl">
                                                            {problema.solucion}
                                                        </p>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {problemasGenerados.length === 0 && (
                            <div className="bg-white rounded-xl shadow-lg p-12 text-center">
                                <Lightbulb size={64} className="mx-auto text-indigo-300 mb-4" />
                                <p className="text-gray-600 text-lg mb-2">
                                    Selecciona el curso, mes y n√∫mero de problemas
                                </p>
                                <p className="text-gray-500">
                                    Luego haz clic en "Generar Problemas" para comenzar
                                </p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<ProblemasGenerator />, document.getElementById('root'));
    </script>
</body>
</html>
